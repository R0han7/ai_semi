<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition Wardrobe App</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="video-container">
        <img src="{{ url_for('video_feed') }}" alt="Video Feed">
    </div>
    <div class="info-container">
        <div id="weatherInfo" class="info-box"></div>
        <div id="outfitRecommendation" class="info-box"></div>
    </div>
    <div class="form-container">
        <form id="eventForm">
            <input type="text" id="event" name="event" placeholder="Enter event (e.g., office party, wedding)">
            <button type="submit">Get Outfit Recommendation</button>
        </form>
    </div>

    <script>
        // Function to fetch weather information
        async function getWeatherInfo() {
            try {
                const response = await fetch('/get_weather_info');
                const data = await response.json();
                
                if (response.ok) {
                    const weatherDiv = document.getElementById('weatherInfo');
                    weatherDiv.innerHTML = `
                        <h3>Weather Information</h3>
                        <p>Temperature: ${data.temp}Â°C</p>
                        <p>Condition: ${data.condition}</p>
                        <p>Season: ${data.season}</p>
                        <p>Preparation: ${data.additional_prep}</p>
                    `;
                } else {
                    console.error('Weather fetch failed:', data.error);
                }
            } catch (error) {
                console.error('Error fetching weather:', error);
            }
        }

        // Function to get outfit recommendation
        document.getElementById('eventForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            
            try {
                const response = await fetch('/get_outfit_recommendation', {
                    method: 'POST',
                    body: formData
                });
                const data = await response.json();
                
                if (response.ok) {
                    const outfitDiv = document.getElementById('outfitRecommendation');
                    const outfitItems = data.outfit_items.map(item => 
                        `${item.type}: ${item.color} ${item.texture} ${item.pattern}`
                    ).join('<br>');
                    
                    outfitDiv.innerHTML = `
                        <h3>Outfit Recommendation</h3>
                        <p>${outfitItems}</p>
                        <p><strong>Why this outfit?</strong><br>${data.explanation}</p>
                        <p><strong>Additional Preparation:</strong><br>${data.additional_prep}</p>
                    `;
                } else {
                    console.error('Outfit recommendation failed:', data.error);
                }
            } catch (error) {
                console.error('Error getting outfit recommendation:', error);
            }
        });

        // Get weather info when page loads and every 5 minutes
        getWeatherInfo();
        setInterval(getWeatherInfo, 5 * 60 * 1000);
    </script>
</body>
</html>